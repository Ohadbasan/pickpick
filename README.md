# Experiments Engine

A/B testing engine (aka experiments)

## Quick and dirty example

Let's say we have a website with two pages `buy` and `index` and we want to run 3 experiments:

-   on the `buy` page test `color button`
-   on the `buy` page test `price`
-   on the `index` page test `text`

### simple example:

```js
const { Experiment, ExperimentContainer, Targeting, matchers, Variation } = require('./index')

// first create the experiments:

let e1 = Experiment.create({
	name: 'buy page button color experiment',
	id: '953d6fe0',
	variations: [
		{ object: '#ff0000', weight: 4 },
		{ object: '#ff0000', weight: 1 },
		{ object: '#00ff00', weight: 1 }
	],
	targeting: {
		page: {
			matcher: 'isIn',
			value: ['buy', 'index']
		}
	} 
})

let e2 = Experiment.create({
	name: 'buy page price experiment',
	id: 'a40f09ac',
	variations: [
		{ object: 25 },
		{ object: 35 },
		{ object: 45 }
	],
	targeting: {
		page: {
			matcher: 'and',
			value: ['!home', '!flex']
		}
	}
})

let e3 = Experiment.create({
	name: 'index text experiment',
	id: 'ac49ef42',
	variations: [
		{ object: 'hi' },
		{ object: 'hello' },
		{ object: 'welcome' }
	],
	targeting: {
		page: {
			matcher: 'isExactly',
			value: 'index'
		}
	}
})

// now create a container:
let experiments = [e1, e2, e3]
let container = ExperimentContainer.create({ experiments })

// simulate a visitor that needs a determination about which variation of which experiment he gets:
let visitor = { page: 'index' }
for (let i = 0; i < 10; i++) {
	let experiment = container.pick(visitor)

	if (!experiment) {
		// no experiment that targets this user
		// handle this with defaults
		console.log('default goes here')
	} else {

		console.log(`selected experiment '${experiment.name}' for '${JSON.stringify(visitor)}'`)
		let variation = experiment.pick()
		console.log(`selected variation is ${variation}`)
	}
}
```

## API

<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

#### Table of Contents

-   [merge](#merge)
-   [ObjectIterator](#objectiterator)
-   [ExperimentContainer](#experimentcontainer)
    -   [add](#add)
    -   [pick](#pick)
    -   [targetingFeatures](#targetingfeatures)
    -   [iterator](#iterator)
    -   [has](#has)
    -   [hasId](#hasid)
    -   [toJSON](#tojson)

### merge

[lib/Experiment.js:94-101](https://github.com/ReasonSoftware/pickpick/blob/fb9479cd087935fe891c0d6231283e809cc80aeb/lib/Experiment.js#L94-L101 "Source code on GitHub")

merge two experiments into one, this will pull
 the input experiment's variation into this one

 merging does not affect the weights of the variations
 if E1 has ( Wv1 = 1, Wv2 = 2) and E2 has (Wv3 = 1, Wv4 = 9)
 then after E2.merge(E1) E2 variation array will look like this:
 ( Wv1 = 1, Wv2 = 2, Wv3 = 1, Wv4 = 9)

**Parameters**

-   `experiment`  

### ObjectIterator

[lib/Variation.js:100-114](https://github.com/ReasonSoftware/pickpick/blob/fb9479cd087935fe891c0d6231283e809cc80aeb/lib/Variation.js#L100-L114 "Source code on GitHub")

wraps an iterator of an array of variations
replacing the Variation instance with the
object which is the "value" of the variation

**Parameters**

-   `variations`  

### ExperimentContainer

[lib/ExperimentContainer.js:38-239](https://github.com/ReasonSoftware/pickpick/blob/fb9479cd087935fe891c0d6231283e809cc80aeb/lib/ExperimentContainer.js#L38-L239 "Source code on GitHub")

Contains one or more experiments and routes traffic evenly to each of them based on their 
   targeting. The following is an example of using a container to host several experiments, pick
   on thats appropriate for a single visitor's targeting and then access a variation from the
   selected experiment:

```js
const { ExperimentContainer, Experiment } = require('pickpick')

const experiments = [
		Experiment.create(...),
		Experiment.create(...),
		Experiment.create(...)
]

const container = ExperimentContainer.create({ experiments })

let experiment = container.pick({ geo: 'US', page: 'index.html '})
if (experiment) {
	let variation = experiment.pick()
	// do something with the variation data
} else {
	console.log('no experiments that match this targeting were found')
}
```

**Parameters**

-   `__seed`  

#### add

[lib/ExperimentContainer.js:78-103](https://github.com/ReasonSoftware/pickpick/blob/fb9479cd087935fe891c0d6231283e809cc80aeb/lib/ExperimentContainer.js#L78-L103 "Source code on GitHub")

Add an experiment to this container. Inside a container experiments must
have unique ids. This method can accept different kinds of experiment expressions:

-   an instance of Experiment:

```js
container.add(Experiment.create(...))
```

-   An instance of Variation where it's object is an Experiment:
        	```js
        	container.add(Variation.create(Experiment.create(...)))
        ````
-   An instance of Variation where it's object is an Expriment defined as an object literal:

```js
container.add(Variation.create({... experiment data ...}))
```

-   A variation object literal wrapping an experiment object literal, this is useful in deserialization scenarios:

```js
container.add({ object: {... experiment data }, weight: 5 })
```

**Parameters**

-   `experiments` **...any** 

#### pick

[lib/ExperimentContainer.js:132-152](https://github.com/ReasonSoftware/pickpick/blob/fb9479cd087935fe891c0d6231283e809cc80aeb/lib/ExperimentContainer.js#L132-L152 "Source code on GitHub")

The pick method accepts a targeting object and randomly selects an experiment
   from a set of experiments that match the targeting specification.

   By default, selection is random and even, however, bias can be applied by specifying a weight 
   when adding an experiment to the container (see ExperimentContainer.add())

   Weights are considered at the moment of selection from the current set of
   matching experiments, therefor, careful planning of targeting is required to achieve 
   accurate traffic distribution betwee experiments.

   For example, consider two experiments, `E1`, that targets `{ geo: 'US', page: '*' }` and `E2` that targets
   `{ geo: 'US', page: 'index.html' }`. If both had the weight `1`, given the following stream
   of visitors: 

    { geo: 'US', page: 'sale.html' }
    { geo: 'US', page: 'index.html' }
    { geo: 'US', page: 'sale.html' }
    { geo: 'US', page: 'index.html' }

   Then it is more likely that `E1` will receive more traffic than `E2` since `E1` competes with `E2` evenly on `index.html`
   page but not on `sale.html`

**Parameters**

-   `targeting` **Targeting** 

Returns **Experiment** an experiment that matches this targeting or null if none is found.

#### targetingFeatures

[lib/ExperimentContainer.js:160-162](https://github.com/ReasonSoftware/pickpick/blob/fb9479cd087935fe891c0d6231283e809cc80aeb/lib/ExperimentContainer.js#L160-L162 "Source code on GitHub")

An iterator over all the targeting features from all the experiments
   added to this container

Returns **Iterator** 

#### iterator

[lib/ExperimentContainer.js:176-178](https://github.com/ReasonSoftware/pickpick/blob/fb9479cd087935fe891c0d6231283e809cc80aeb/lib/ExperimentContainer.js#L176-L178 "Source code on GitHub")

iterate over all the experiments in this container:

    let container = ExperimentContainer.create(...)

    for (let experiment of container) {
    	console.log(experiment.id)
    	}

Returns **[ObjectIterator](#objectiterator)** 

#### has

[lib/ExperimentContainer.js:185-188](https://github.com/ReasonSoftware/pickpick/blob/fb9479cd087935fe891c0d6231283e809cc80aeb/lib/ExperimentContainer.js#L185-L188 "Source code on GitHub")

check if this container contains the specified experiment

**Parameters**

-   `experiment` **Expriment** 

Returns **[Boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** 

#### hasId

[lib/ExperimentContainer.js:195-201](https://github.com/ReasonSoftware/pickpick/blob/fb9479cd087935fe891c0d6231283e809cc80aeb/lib/ExperimentContainer.js#L195-L201 "Source code on GitHub")

check if this container contains an experiment using an id

**Parameters**

-   `experimentId` **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** 

Returns **[Boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** 

#### toJSON

[lib/ExperimentContainer.js:208-215](https://github.com/ReasonSoftware/pickpick/blob/fb9479cd087935fe891c0d6231283e809cc80aeb/lib/ExperimentContainer.js#L208-L215 "Source code on GitHub")

serialize this container with all it's experiments

Returns **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** 

## matching / targeting short forms

todo: document

## serializing / deserializing

todo: toJSON for Targeting
